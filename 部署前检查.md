# ✅ 部署前最终检查清单

## 🎯 确保 Vercel 成功构建和显示 UI

---

## 📋 第一步：文件完整性检查

### 必需文件清单

在项目根目录，确认以下文件存在：

```
✅ index.html              - 主页面
✅ vercel.json             - Vercel 配置
✅ package.json            - 项目配置
✅ .gitignore              - Git 忽略文件
```

### API 文件检查

在 `api/` 目录：

```
✅ api/stripe.js           - 订阅信息 API
✅ api/usage.js            - 使用统计 API
```

### 静态资源检查

在 `public/` 目录：

```
✅ public/style.css        - 样式文件
✅ public/script.js        - 脚本文件
```

---

## 🔍 第二步：文件内容检查

### 1. 检查 `index.html`

打开文件，确认：

```html
<!-- 第 7 行：CSS 引用 -->
<link rel="stylesheet" href="/style.css">

<!-- 最后：JS 引用 -->
<script src="/script.js"></script>
```

✅ 路径以 `/` 开头（不是 `./` 或 `public/`）

### 2. 检查 `api/stripe.js`

确认文件导出格式：

```javascript
export default async function handler(req, res) {
    // ... 代码
}
```

✅ 使用 `export default`
✅ 函数名为 `handler`

### 3. 检查 `api/usage.js`

确认文件导出格式同上。

### 4. 检查 `vercel.json`

确认配置正确：

```json
{
  "rewrites": [
    {
      "source": "/style.css",
      "destination": "/public/style.css"
    },
    {
      "source": "/script.js",
      "destination": "/public/script.js"
    }
  ]
}
```

---

## 📤 第三步：Git 提交检查

### 检查 Git 状态

```bash
git status
```

确认输出：
```
On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean
```

✅ 所有文件已提交
✅ 已推送到 GitHub

### 如果有未提交的文件

```bash
git add .
git commit -m "准备部署：更新 Vercel 配置"
git push
```

---

## 🚀 第四步：Vercel 配置检查

### 在 Vercel Dashboard 中确认：

| 配置项 | 正确值 | ❌ 错误值 |
|--------|--------|---------|
| Framework Preset | **Other** | Next.js, React, Vue |
| Root Directory | `./` | （其他路径） |
| Build Command | **留空** | npm run build |
| Output Directory | **留空** | dist, build |
| Install Command | **留空或自动** | （自定义命令） |

---

## 🖥️ 第五步：Vercel UI 操作步骤

### 完整操作流程：

1. **登录 Vercel**
   - 访问 https://vercel.com
   - 使用 GitHub 账号登录

2. **导入项目**
   - 点击 "Add New..." → "Project"
   - 找到 `cursor-usage-checker` 仓库
   - 点击 "Import"

3. **配置项目**
   
   在 "Configure Project" 页面：
   
   ```
   Project Name: cursor-usage-checker
   
   Framework Preset: Other  ← 重要！
   
   Root Directory: ./
   
   Build and Output Settings:
   ├─ Build Command: [留空]    ← 重要！
   ├─ Output Directory: [留空]  ← 重要！
   └─ Install Command: [留空]
   
   Environment Variables: [跳过]
   ```

4. **部署**
   - 点击 "Deploy" 按钮
   - 等待 30-60 秒

5. **验证**
   - 看到 "Congratulations!" 页面
   - 获得网址：`https://xxx.vercel.app`

---

## ✅ 第六步：部署成功验证

### 打开浏览器开发者工具（F12）

访问你的 Vercel 网址，检查：

### 1. 页面加载检查

在 Console（控制台）标签：

```
✅ 无红色错误
✅ 无 404 错误
✅ 无 CORS 错误
```

### 2. 网络请求检查

在 Network（网络）标签：

| 文件 | 状态 | 类型 |
|------|------|------|
| index.html | 200 ✅ | document |
| style.css | 200 ✅ | stylesheet |
| script.js | 200 ✅ | script |

### 3. 页面元素检查

在页面上应该看到：

```
✅ 标题："🔍 Cursor 账号查询"
✅ 输入框
✅ "查询" 按钮
✅ "清空" 按钮
✅ 深色主题背景
✅ 渐变色标题
```

### 4. API 端点检查

手动访问 API（会返回错误，但不应该 404）：

```
https://your-domain.vercel.app/api/stripe
→ 应返回：{"error":"方法不允许"} 或类似错误

✅ 不是 404
✅ 说明 API 已部署
```

---

## 🧪 第七步：功能测试

### 获取测试 Token

1. 访问 https://cursor.com/cn/dashboard
2. 按 F12 打开开发者工具
3. Network 标签 → 找到请求 → Headers → Cookie
4. 复制 `WorkosCursorSessionToken=` 的完整值

### 测试查询功能

1. 在你的网站输入框粘贴 Token
2. 点击 "查询" 按钮
3. 观察结果：

```
成功情况：
✅ 显示 "账户信息" 卡片
✅ 显示 "使用统计" 卡片
✅ 显示 "原始数据" 卡片
✅ 数据正确显示

失败情况：
❌ 显示错误信息
→ 检查 Token 是否正确
→ 检查 Token 是否过期
→ 查看浏览器控制台错误
```

---

## 🐛 常见问题快速修复

### 问题 1：Vercel 构建失败

**症状**：部署失败，显示构建错误

**快速修复**：
```bash
# 1. 进入 Vercel Settings → General
# 2. Build & Development Settings 全部留空
# 3. 保存
# 4. Deployments → 点最新的 → Redeploy
```

---

### 问题 2：页面 404

**症状**：访问网址显示 404

**快速修复**：
```bash
# 1. 确认 index.html 在根目录
# 2. 确认已推送到 GitHub
# 3. 重新部署
```

---

### 问题 3：样式丢失

**症状**：页面显示但没有样式

**快速修复**：

1. 检查 `vercel.json` 是否存在
2. 检查 `public/style.css` 是否存在
3. 按 F12 查看 Network 标签，看 style.css 是否 404
4. 如果 404，确认 `vercel.json` 配置正确

---

### 问题 4：API 调用失败

**症状**：点击查询无反应或报错

**快速修复**：

1. F12 → Network 标签
2. 找到 `/api/stripe` 或 `/api/usage` 请求
3. 查看状态码和响应
4. 如果 404：检查 `api/` 目录文件
5. 如果 500：查看 Vercel Functions 日志

---

## 📊 Vercel 部署日志解读

### 成功的日志：

```
✓ Building
  Detected Other framework
  
✓ Uploading
  - index.html
  - public/style.css
  - public/script.js
  - api/stripe.js
  - api/usage.js
  
✓ Deploying
  2 Serverless Functions deployed:
  - /api/stripe
  - /api/usage
  
✓ Assigned Domain
  https://your-project.vercel.app
  
✅ Build Completed
```

### 失败的日志示例：

```
❌ Error: Build failed
Reason: Command "npm run build" not found
```

**解决**：删除 Build Command 配置

---

## 🎯 最终确认清单

部署成功的标志：

- [ ] Vercel 显示 "Build Completed"
- [ ] 获得 `.vercel.app` 域名
- [ ] 访问网址能看到查询页面
- [ ] 页面样式完整（深色主题）
- [ ] 输入框、按钮正常显示
- [ ] 输入 Token 后能查询到数据
- [ ] 浏览器控制台无错误

---

## 🎉 成功！

如果以上所有检查都通过，恭喜！你的项目已成功部署！

### 下一步：

1. 🔖 收藏你的网址
2. 📱 分享给朋友
3. 🎨 考虑绑定自定义域名
4. 📊 查看 Vercel Analytics

---

## 🆘 仍然有问题？

### 查看详细文档：

- [VERCEL部署图文教程.md](./VERCEL部署图文教程.md) - 图文步骤
- [VERCEL配置说明.md](./VERCEL配置说明.md) - 配置详解
- [README.md](./README.md) - 完整说明

### 获取帮助：

- 💬 提交 Issue
- 📧 查看 Vercel 文档
- 🔍 搜索相似问题

---

**祝部署顺利！** 🚀

