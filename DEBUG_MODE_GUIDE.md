# ğŸ” è°ƒè¯•æ¨¡å¼ä½¿ç”¨æŒ‡å—

## ä¸ºä»€ä¹ˆéœ€è¦è°ƒè¯•æ¨¡å¼ï¼Ÿ

æ‚¨æåˆ°æƒ³è¦çœ‹åˆ°å‘é€ç»™ `https://www.cursor.com/api/auth/stripe` çš„å®é™…è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯ Cookie å¤´éƒ¨çš„ `WorkosCursorSessionToken` å€¼ã€‚

**é—®é¢˜æ˜¯**ï¼šè¿™ä¸ªè¯·æ±‚æ˜¯åœ¨æœåŠ¡å™¨ç«¯ï¼ˆVercel Functionï¼‰å‘å‡ºçš„ï¼Œæµè§ˆå™¨çš„ Network é¢æ¿**çœ‹ä¸åˆ°**ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼šæˆ‘æ·»åŠ äº†ä¸€ä¸ª**è°ƒè¯•æ¨¡å¼**ï¼Œå¯ä»¥åœ¨å“åº”ä¸­è¿”å›å®Œæ•´çš„è¯·æ±‚è¯¦æƒ…ï¼

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨è°ƒè¯•æ¨¡å¼

### æ–¹æ³•1ï¼šä½¿ç”¨ Token æµ‹è¯•å·¥å…·ï¼ˆæœ€ç®€å•ï¼‰

1. **éƒ¨ç½²ä»£ç åï¼Œè®¿é—®ç½‘ç«™**
   ```
   https://cursor-usermanner.vercel.app
   ```

2. **ç‚¹å‡»é¡¶éƒ¨æŒ‰é’®**
   ```
   ğŸ”¬ æ˜¾ç¤ºTokenæµ‹è¯•å·¥å…·
   ```

3. **ç²˜è´´æ‚¨çš„ Token**

4. **ç‚¹å‡»æ©™è‰²æŒ‰é’®**
   ```
   ğŸ” è°ƒè¯•æ¨¡å¼æµ‹è¯•
   ```

5. **æŸ¥çœ‹ç»“æœ** ğŸ‰

   æˆåŠŸåä¼šæ˜¾ç¤ºï¼š
   
   ```
   âœ… Token æœ‰æ•ˆï¼
   
   ğŸ” è¯·æ±‚è¯¦æƒ…ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰
   
   1ï¸âƒ£ å‰ç«¯ â†’ Vercel Function
   {
     "method": "GET",
     "url": "https://cursor-usermanner.vercel.app/api/auth/stripe?debug=true",
     "headers": {
       "X-Cursor-Token": "user_2XXXXXXXXXX...",
       "Origin": "https://cursor-usermanner.vercel.app"
     }
   }
   
   2ï¸âƒ£ Vercel Function â†’ Cursor API  ğŸ‘ˆ è¿™æ˜¯æ‚¨æƒ³çœ‹çš„ï¼
   ğŸ‘‡ è¿™å°±æ˜¯å®é™…å‘é€ç»™ Cursor çš„è¯·æ±‚ï¼
   {
     "method": "GET",
     "url": "https://www.cursor.com/api/auth/stripe",
     "headers": {
       "Cookie": "WorkosCursorSessionToken=user_2XXXXXXXXXX...",  ğŸ‘ˆ è¿™é‡Œï¼
       "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)...",
       "Accept": "application/json, text/plain, */*",
       "Origin": "https://www.cursor.com",
       "Referer": "https://www.cursor.com/"
     }
   }
   
   Cookie å¤´éƒ¨å†…å®¹ï¼š
   WorkosCursorSessionToken=user_2XXXXXXXXXXXXXXXXXXXXXXXXXX
   ```

---

### æ–¹æ³•2ï¼šä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°

å¦‚æœä½¿ç”¨è°ƒè¯•æ¨¡å¼æµ‹è¯•ï¼Œæµè§ˆå™¨æ§åˆ¶å°ä¼šæ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š

1. **æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·**

2. **åˆ‡æ¢åˆ° Console æ ‡ç­¾**

3. **ç‚¹å‡» "ğŸ” è°ƒè¯•æ¨¡å¼æµ‹è¯•"**

4. **åœ¨æ§åˆ¶å°æŸ¥çœ‹**ï¼š

   ```javascript
   ğŸ” Token æµ‹è¯• - è°ƒè¯•æ¨¡å¼
     å®Œæ•´å“åº”æ•°æ®: {...}
     å‘é€åˆ° Cursor çš„ Cookie: WorkosCursorSessionToken=user_2XXXXXXXXXX...
   ```

---

### æ–¹æ³•3ï¼šç›´æ¥åœ¨ API è¯·æ±‚ä¸­å¯ç”¨

å¦‚æœæ‚¨åœ¨ä»£ç ä¸­è°ƒç”¨ APIï¼Œå¯ä»¥è¿™æ ·å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š

```javascript
// æ™®é€šæ¨¡å¼
const result = await queryUserStripeInfo(token);

// è°ƒè¯•æ¨¡å¼ï¼ˆç¬¬äºŒä¸ªå‚æ•°è®¾ä¸º trueï¼‰
const result = await queryUserStripeInfo(token, true);

// å“åº”ä¼šåŒ…å« _debug å­—æ®µ
if (result.success && result.data._debug) {
  console.log('å‘é€åˆ° Cursor çš„è¯·æ±‚:', result.data._debug.requestToCursor);
  console.log('Cookie å¤´:', result.data._debug.requestToCursor.headers.Cookie);
}
```

---

## ğŸ“Š è°ƒè¯•æ¨¡å¼è¿”å›çš„ä¿¡æ¯

### å®Œæ•´çš„å“åº”ç»“æ„

```json
{
  "membershipType": "free_trial",
  "daysRemainingOnTrial": 6,
  "subscriptionStatus": "trialing",
  "paymentId": "cus_XXX",
  // ... å…¶ä»–æ­£å¸¸å­—æ®µ
  
  "_debug": {
    "note": "è¿™æ˜¯è°ƒè¯•ä¿¡æ¯ï¼Œä»…åœ¨æ·»åŠ  ?debug=true æˆ– X-Debug: true æ—¶æ˜¾ç¤º",
    
    "requestToVercel": {
      "method": "GET",
      "url": "https://cursor-usermanner.vercel.app/api/auth/stripe?debug=true",
      "headers": {
        "X-Cursor-Token": "user_2XXXXXXXXXX...",
        "Origin": "https://cursor-usermanner.vercel.app",
        "User-Agent": "Mozilla/5.0..."
      }
    },
    
    "requestToCursor": {  ğŸ‘ˆ è¿™æ˜¯æ‚¨æœ€æƒ³çœ‹çš„éƒ¨åˆ†
      "method": "GET",
      "url": "https://www.cursor.com/api/auth/stripe",
      "headers": {
        "Cookie": "WorkosCursorSessionToken=user_2XXXXXXXXXX...",  ğŸ‘ˆ Cookie å¤´ï¼
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)...",
        "Accept": "application/json, text/plain, */*",
        "Origin": "https://www.cursor.com",
        "Referer": "https://www.cursor.com/"
      }
    },
    
    "tokenInfo": {
      "length": 45,
      "prefix": "user_2XXXXXXXXXX",
      "startsWithUser": true
    },
    
    "cursorResponse": {
      "status": 200,
      "statusText": "OK",
      "contentLength": 285
    }
  }
}
```

---

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šéªŒè¯ Token æ˜¯å¦æ­£ç¡®å‘é€

**é—®é¢˜**ï¼šä¸ç¡®å®š Token æ˜¯å¦æ­£ç¡®ä¼ é€’ç»™ Cursor API

**è§£å†³**ï¼š
1. ä½¿ç”¨è°ƒè¯•æ¨¡å¼æµ‹è¯•
2. æŸ¥çœ‹ `_debug.requestToCursor.headers.Cookie`
3. ç¡®è®¤å®Œæ•´çš„ Token å€¼

### åœºæ™¯2ï¼šè¯Šæ–­ 401 é”™è¯¯

**é—®é¢˜**ï¼šæ”¶åˆ° 401 é”™è¯¯ï¼Œä¸çŸ¥é“æ˜¯ Token é—®é¢˜è¿˜æ˜¯è¯·æ±‚é—®é¢˜

**è§£å†³**ï¼š
1. ä½¿ç”¨è°ƒè¯•æ¨¡å¼æµ‹è¯•
2. æŸ¥çœ‹ `_debug.tokenInfo` ç¡®è®¤ Token æ ¼å¼
3. æŸ¥çœ‹ `_debug.requestToCursor` ç¡®è®¤è¯·æ±‚æ ¼å¼
4. æŸ¥çœ‹ `_debug.cursorResponse.status` äº†è§£ Cursor çš„å®é™…å“åº”

### åœºæ™¯3ï¼šå¯¹æ¯”å·¥ä½œå’Œä¸å·¥ä½œçš„è¯·æ±‚

**é—®é¢˜**ï¼šæŸäº› Token èƒ½ç”¨ï¼ŒæŸäº›ä¸èƒ½ï¼Œä¸çŸ¥é“å·®å¼‚åœ¨å“ª

**è§£å†³**ï¼š
1. å¯¹ä¸¤ä¸ª Token éƒ½ä½¿ç”¨è°ƒè¯•æ¨¡å¼
2. å¯¹æ¯” `_debug.requestToCursor` çš„å·®å¼‚
3. å¯¹æ¯” `_debug.tokenInfo` çš„å·®å¼‚
4. æ‰¾å‡ºé—®é¢˜æ‰€åœ¨

---

## ğŸ” å®‰å…¨è¯´æ˜

### è°ƒè¯•ä¿¡æ¯çš„å®‰å…¨æ€§

1. **Token è„±æ•**ï¼š
   - è°ƒè¯•ä¿¡æ¯ä¸­çš„ Token åªæ˜¾ç¤ºå‰ 20 ä¸ªå­—ç¬¦
   - å®Œæ•´ Token ä¸ä¼šæš´éœ²åœ¨å“åº”ä¸­ï¼ˆåªåœ¨æœåŠ¡å™¨ç«¯æ—¥å¿—ï¼‰

2. **ä»…åœ¨éœ€è¦æ—¶å¯ç”¨**ï¼š
   - å¿…é¡»æ˜ç¡®æ·»åŠ  `?debug=true` æˆ– `X-Debug: true`
   - ä¸ä¼šé»˜è®¤å¼€å¯

3. **ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
   - ä»…åœ¨è¯Šæ–­é—®é¢˜æ—¶ä½¿ç”¨
   - é—®é¢˜è§£å†³åç§»é™¤è°ƒè¯•å‚æ•°

---

## ğŸ“‹ å®Œæ•´çš„æµ‹è¯•æµç¨‹

### æ­¥éª¤1ï¼šéƒ¨ç½²ä»£ç 

```bash
git add .
git commit -m "feat: æ·»åŠ è°ƒè¯•æ¨¡å¼ï¼Œå¯æŸ¥çœ‹å®Œæ•´è¯·æ±‚è¯¦æƒ…"
git push origin main
```

### æ­¥éª¤2ï¼šè®¿é—®ç½‘ç«™å¹¶æµ‹è¯•

1. è®¿é—® https://cursor-usermanner.vercel.app
2. ç‚¹å‡» `ğŸ”¬ æ˜¾ç¤ºTokenæµ‹è¯•å·¥å…·`
3. ç²˜è´´ Token
4. ç‚¹å‡» `ğŸ” è°ƒè¯•æ¨¡å¼æµ‹è¯•`ï¼ˆæ©™è‰²æŒ‰é’®ï¼‰

### æ­¥éª¤3ï¼šæŸ¥çœ‹ç»“æœ

âœ… **æˆåŠŸæ—¶**ï¼š
- ç»¿è‰²æ¡†æ˜¾ç¤ºä¼šå‘˜ä¿¡æ¯
- ä¸‹æ–¹æ˜¾ç¤ºå®Œæ•´çš„è¯·æ±‚è¯¦æƒ…
- Cookie å¤´éƒ¨æ¸…æ™°å¯è§

âŒ **å¤±è´¥æ—¶**ï¼š
- çº¢è‰²æ¡†æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- æ ¹æ®é”™è¯¯æç¤ºé‡‡å–ç›¸åº”æªæ–½

---

## ğŸ†š æ™®é€šæ¨¡å¼ vs è°ƒè¯•æ¨¡å¼

| ç‰¹æ€§ | æ™®é€šæ¨¡å¼ | è°ƒè¯•æ¨¡å¼ |
|------|---------|----------|
| å“åº”å¤§å° | å°ï¼ˆä»…ä¸šåŠ¡æ•°æ®ï¼‰ | å¤§ï¼ˆåŒ…å«è°ƒè¯•ä¿¡æ¯ï¼‰ |
| è¯·æ±‚è¯¦æƒ… | âŒ ä¸æ˜¾ç¤º | âœ… å®Œæ•´æ˜¾ç¤º |
| Cookie å¤´ | âŒ çœ‹ä¸åˆ° | âœ… æ¸…æ™°å¯è§ |
| Token ä¿¡æ¯ | âŒ ä¸æ˜¾ç¤º | âœ… é•¿åº¦ã€æ ¼å¼æ£€æŸ¥ |
| é€‚ç”¨åœºæ™¯ | æ­£å¸¸ä½¿ç”¨ | è°ƒè¯•è¯Šæ–­ |
| æ€§èƒ½ | æ›´å¿« | ç•¥æ…¢ï¼ˆæ›´å¤šå¤„ç†ï¼‰ |

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæµè§ˆå™¨ Network é¢æ¿çœ‹ä¸åˆ°å‘é€ç»™ Cursor çš„è¯·æ±‚ï¼Ÿ

**A**: å› ä¸ºè¿™æ˜¯æœåŠ¡å™¨ç«¯è¯·æ±‚ï¼

```
ç”¨æˆ·æµè§ˆå™¨
  â†“ (ä½ èƒ½çœ‹åˆ°)
Vercel Function
  â†“ (ä½ çœ‹ä¸åˆ°ï¼Œè¿™æ˜¯æœåŠ¡å™¨ç«¯)
Cursor API
```

æµè§ˆå™¨åªèƒ½çœ‹åˆ°ç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œçœ‹ä¸åˆ°æœåŠ¡å™¨ç«¯å‘å‡ºçš„è¯·æ±‚ã€‚

### Q2: è°ƒè¯•æ¨¡å¼ä¼šå½±å“æ­£å¸¸åŠŸèƒ½å—ï¼Ÿ

**A**: ä¸ä¼šï¼è°ƒè¯•æ¨¡å¼åªæ˜¯åœ¨å“åº”ä¸­æ·»åŠ  `_debug` å­—æ®µï¼Œä¸å½±å“ä¸šåŠ¡æ•°æ®ã€‚

### Q3: Token ä¼šæ³„éœ²å—ï¼Ÿ

**A**: ä¸ä¼šï¼è°ƒè¯•ä¿¡æ¯ä¸­çš„ Token å·²è„±æ•ï¼Œåªæ˜¾ç¤ºå‰ 20 ä¸ªå­—ç¬¦ã€‚

### Q4: ç”Ÿäº§ç¯å¢ƒå¯ä»¥ç”¨å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†å»ºè®®åªåœ¨è¯Šæ–­é—®é¢˜æ—¶ä½¿ç”¨ï¼Œé—®é¢˜è§£å†³åç§»é™¤è°ƒè¯•å‚æ•°ã€‚

---

## ğŸ‰ æ€»ç»“

ç°åœ¨æ‚¨å¯ä»¥ï¼š

1. âœ… **çœ‹åˆ°å®Œæ•´çš„è¯·æ±‚æµç¨‹**
   - å‰ç«¯ â†’ Vercel
   - Vercel â†’ Cursor

2. âœ… **æŸ¥çœ‹å®é™…çš„ Cookie å¤´**
   - `WorkosCursorSessionToken=å…·ä½“çš„å€¼`

3. âœ… **éªŒè¯ Token æ­£ç¡®æ€§**
   - é•¿åº¦ã€æ ¼å¼ã€å‰ç¼€

4. âœ… **è¯Šæ–­ 401 é”™è¯¯**
   - Token ä¿¡æ¯
   - è¯·æ±‚æ ¼å¼
   - Cursor å“åº”

**ç«‹å³éƒ¨ç½²å¹¶ä½¿ç”¨è°ƒè¯•æ¨¡å¼æµ‹è¯•å§ï¼** ğŸš€

ç‚¹å‡» `ğŸ” è°ƒè¯•æ¨¡å¼æµ‹è¯•` æŒ‰é’®ï¼Œæ‚¨å°†çœ‹åˆ°æ‰€æœ‰æ‚¨æƒ³è¦çš„ä¿¡æ¯ï¼

