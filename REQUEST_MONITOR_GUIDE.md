# 📡 实时请求监控器使用指南

## 🎯 这是什么？

**实时请求监控器**是一个可视化工具，可以让您**直接在网页上**看到所有发送的请求详情，包括：

- ✅ 前端 → Vercel Function 的请求
- ✅ **Vercel Function → Cursor API 的实际请求**（包括 Cookie 头部）
- ✅ Cursor API 的响应
- ✅ Token 信息和验证结果
- ✅ 可以复制的 cURL 命令

**无需查看日志，无需打开开发者工具，所有信息一目了然！**

---

## 🚀 如何使用

### 部署后立即可用

1. **访问网站**
   ```
   https://cursor-usermanner.vercel.app
   ```

2. **查看监控器**
   - 页面下方会自动显示"📡 实时请求监控"
   - 初始状态显示"💤 暂无请求记录"

3. **触发请求**
   - 方式1：点击表格中的"查询Stripe"按钮
   - 方式2：使用"🔬 Token测试工具"
   - 方式3：在详情页点击"查询Stripe信息"

4. **查看结果** 🎉
   - 监控器会立即显示新的请求记录
   - 自动展开，显示完整详情
   - 包含您想要的所有信息！

---

## 📊 监控器界面说明

### 主界面

```
┌─────────────────────────────────────────┐
│ 📡 实时请求监控                          │
│                       [🗑️清空] [📋生成cURL] │
├─────────────────────────────────────────┤
│ ✅ 2024-10-06 14:30:25  GET  200 OK  ▼  │
│                                         │
│ 1️⃣ 前端 → Vercel Function              │
│ URL: https://cursor-usermanner...       │
│ Headers: ...                            │
│                                         │
│ 2️⃣ Vercel Function → Cursor API        │
│ 👇 这是实际发送给 Cursor 的请求！         │
│ URL: https://www.cursor.com/api/...    │
│ Headers:                               │
│   Cookie: WorkosCursorSessionToken=... │
│   User-Agent: ...                      │
│   Accept: ...                          │
│   Origin: https://www.cursor.com       │
│   Referer: https://www.cursor.com/     │
│                                         │
│ 🍪 Cookie 头部:                         │
│ ┌─────────────────────────────────────┐│
│ │WorkosCursorSessionToken=user_2XXX...││
│ └─────────────────────────────────────┘│
│                                         │
│ 📨 Cursor API 响应                      │
│ 状态码: 200 OK                          │
│ 响应数据: {...}                         │
│                                         │
│ 📝 Token 信息                           │
│ 长度: 45 字符                           │
│ 前缀: user_2XXXXXXXXXX...              │
│ 格式: ✅ 正确（以user_开头）             │
│                                         │
│ [📋 复制等效的 cURL 命令]                │
└─────────────────────────────────────────┘
```

---

## 🔍 查看实际请求的步骤

### 您想看的信息在这里：

1. **点击任意查询按钮**（表格、测试工具、详情页）

2. **滚动到"实时请求监控"区域**

3. **查看"2️⃣ Vercel Function → Cursor API"部分**
   - 这就是实际发送给 Cursor 的请求！
   - URL: `https://www.cursor.com/api/auth/stripe`
   - Method: `GET`
   - Headers: 所有请求头，包括 Cookie

4. **特别关注"🍪 Cookie 头部"黄色框**
   - 这里清晰显示完整的 Cookie 值
   - `WorkosCursorSessionToken=user_2XXXXXXXXXXXXXXXXXXXXXXXXXX`

---

## 🎯 实际使用场景

### 场景1：验证 Token 是否正确发送

**操作**：
1. 使用 Token 测试工具测试
2. 查看监控器中的"🍪 Cookie 头部"
3. 确认 Token 完整无误

**结果**：
```
🍪 Cookie 头部:
WorkosCursorSessionToken=user_2abcdefghijklmnopqrstuvwxyz123456789
```

### 场景2：诊断 401 错误

**操作**：
1. 查询后收到 401 错误
2. 查看监控器
3. 检查"📝 Token 信息"部分

**可能发现**：
```
格式: ❌ 错误
```
→ Token 不是以 `user_` 开头，格式错误！

### 场景3：对比成功和失败的请求

**操作**：
1. 测试一个成功的 Token（显示绿色边框）
2. 测试一个失败的 Token（显示红色边框）
3. 对比两个请求的差异

**发现差异**：
- Token 长度不同
- Token 格式不同
- 响应状态码不同

### 场景4：生成 cURL 命令直接测试

**操作**：
1. 查看任意请求记录
2. 点击"📋 复制等效的 cURL 命令"
3. 在终端粘贴运行

**得到**：
```bash
curl -X GET \
  -H "Cookie: WorkosCursorSessionToken=user_2XXX..." \
  -H "User-Agent: Mozilla/5.0..." \
  -H "Accept: application/json" \
  -H "Origin: https://www.cursor.com" \
  -H "Referer: https://www.cursor.com/" \
  https://www.cursor.com/api/auth/stripe
```

在终端运行，直接测试 Cursor API！

---

## 🛠️ 功能特性

### 1. 自动记录

- ✅ 所有请求自动记录
- ✅ 成功请求显示绿色边框
- ✅ 失败请求显示红色边框
- ✅ 最多保留 20 条记录

### 2. 详细信息

每条记录包含：
- ⏰ 时间戳
- 🔢 状态码
- 📋 请求详情（两步）
- 🍪 Cookie 头部（高亮显示）
- 📨 响应数据
- 📝 Token 信息

### 3. 交互功能

- 🗑️ **清空按钮**：清空所有记录
- 📋 **生成 cURL**：生成可复制的命令
- ▼ **展开/折叠**：点击标题展开或折叠详情
- 📋 **复制 cURL**：每条记录都可以复制对应的 cURL 命令

### 4. cURL 命令生成器

**功能**：
- 点击顶部"📋 生成 cURL 命令"按钮
- 粘贴任意 Token
- 自动生成可直接运行的 cURL 命令
- 自动复制到剪贴板

**用途**：
- 在终端直接测试 Token
- 验证 Token 是否有效
- 调试网络问题

---

## 🎨 视觉说明

### 颜色标识

| 颜色 | 含义 | 元素 |
|------|------|------|
| 绿色 | 成功 | 边框、状态码、图标 |
| 红色 | 失败 | 边框、状态码、图标 |
| 橙色 | 重点 | Cursor API 请求区域 |
| 黄色 | 高亮 | Cookie 头部显示 |
| 蓝色 | HTTP方法 | GET 标签 |

### 区域说明

```
┌─────────────────────────────────┐
│ 灰色背景：基础信息              │
├─────────────────────────────────┤
│ 白色背景：前端请求              │
├─────────────────────────────────┤
│ 橙色背景：Cursor请求 ⭐重点      │
│ ├─ 黄色框：Cookie 头部 ⭐⭐重点 │
├─────────────────────────────────┤
│ 白色背景：响应和Token信息       │
└─────────────────────────────────┘
```

---

## 📱 响应式设计

### 桌面端
- 完整显示所有信息
- 左右布局，易于阅读

### 移动端
- 自动适应屏幕宽度
- 上下布局，方便滚动
- 保持所有功能可用

---

## 💡 使用技巧

### 技巧1：快速定位问题

1. 查看状态码颜色
   - 绿色 = 成功，不用管
   - 红色 = 失败，展开查看

2. 重点查看橙色区域
   - 这是发送给 Cursor 的实际请求
   - Cookie 头部是否正确

3. 检查 Token 信息
   - 格式是否正确（✅/❌）
   - 长度是否合理（通常 40-50 字符）

### 技巧2：使用 cURL 验证

1. 点击"📋 复制等效的 cURL 命令"
2. 打开终端粘贴运行
3. 查看返回结果
4. 如果 cURL 也失败 = Token 确实无效
5. 如果 cURL 成功 = 网站代码可能有问题

### 技巧3：保存记录用于对比

1. 测试多个 Token
2. 对比成功和失败的请求
3. 找出差异点
4. 确定问题根源

### 技巧4：清空旧记录

- 测试前点击"🗑️ 清空"
- 保持界面整洁
- 方便查找新记录

---

## 🔐 安全说明

### Token 显示策略

1. **完整显示场景**：
   - Cookie 头部（仅在监控器中）
   - 用于生成 cURL 命令

2. **部分显示场景**：
   - Token 前缀（前 20 个字符）
   - 用于识别和对比

3. **安全措施**：
   - 监控器仅在本地显示
   - 数据不会上传到服务器
   - 最多保留 20 条记录
   - 页面刷新后清空

### 建议

- ✅ 在安全环境下使用
- ✅ 不要分享监控器截图（包含完整Token）
- ✅ 测试完成后关闭页面
- ❌ 不要在公共场合展示监控器

---

## 🆚 对比其他调试方法

| 方法 | 优点 | 缺点 | 监控器 |
|------|------|------|--------|
| 浏览器 Network | 原生工具 | 看不到服务器端请求 | ✅ 可以看到 |
| Vercel 日志 | 完整信息 | 需要登录，查看麻烦 | ✅ 界面直观 |
| 控制台 Console | 即时显示 | 信息分散，不易查找 | ✅ 结构化展示 |
| 调试模式 | 详细信息 | 需要手动开启 | ✅ 自动记录 |
| cURL 命令 | 直接测试 | 需要手动构造 | ✅ 一键生成 |

---

## 🎉 总结

### 您现在可以：

1. ✅ **直接在网页上看到所有请求**
   - 不需要打开开发者工具
   - 不需要查看 Vercel 日志
   - 不需要手写 cURL 命令

2. ✅ **清楚地看到发送给 Cursor 的实际请求**
   - 完整的 URL
   - 所有 Headers
   - **Cookie 头部的完整值**

3. ✅ **快速诊断问题**
   - 一眼看出成功/失败
   - Token 格式自动检查
   - 提供可执行的 cURL 命令

4. ✅ **记录和对比请求**
   - 自动记录最近 20 条
   - 方便对比差异
   - 找出问题根源

---

## 🚀 立即使用

```bash
# 1. 部署代码
git add .
git commit -m "feat: 添加实时请求监控器，直观查看所有请求详情"
git push origin main

# 2. 访问网站
打开 https://cursor-usermanner.vercel.app

# 3. 触发请求
点击"查询Stripe"或使用测试工具

# 4. 查看监控器
滚动到"📡 实时请求监控"区域

# 5. 查看实际请求
重点查看"2️⃣ Vercel Function → Cursor API"部分
特别关注"🍪 Cookie 头部"黄色框
```

---

## 🎯 关键信息位置

您最想看的"实际发送的请求"在这里：

```
📡 实时请求监控
  ↓
展开任意请求记录
  ↓
找到"2️⃣ Vercel Function → Cursor API"（橙色背景）
  ↓
查看 Headers 部分
  ↓
特别关注"🍪 Cookie 头部"（黄色框）
  ↓
这里就是完整的 Cookie 值！
WorkosCursorSessionToken=user_2XXXXXXXXXXXXXXXXXXXXXXXXXX
```

**这就是您想看的实际请求！** 🎯🎉

